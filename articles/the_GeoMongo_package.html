<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geospatial Queries using Pymongo in R • GeoMongo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Geospatial Queries using Pymongo in R">
<meta property="og:description" content="GeoMongo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GeoMongo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/the_GeoMongo_package.html">Geospatial Queries using Pymongo in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlampros/GeoMongo/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="the_GeoMongo_package_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Geospatial Queries using Pymongo in R</h1>
                        <h4 class="author">Lampros Mouselimis</h4>
            
            <h4 class="date">2021-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mlampros/GeoMongo/blob/master/vignettes/the_GeoMongo_package.Rmd"><code>vignettes/the_GeoMongo_package.Rmd</code></a></small>
      <div class="hidden name"><code>the_GeoMongo_package.Rmd</code></div>

    </div>

    
    
<p>Since I submitted the <a href="https://CRAN.R-project.org/package=geojsonR"><em>geojsonR</em> package</a> I was interested in running geospatial MongoDB queries using GeoJson data. I decided to use PyMongo (through the reticulate package) after opening two Github issues <a href="https://github.com/jeroen/mongolite/issues/7">here</a> and <a href="https://github.com/rstudio/reticulate/issues/81">here</a>. In my opinion, the PyMongo library is huge and covers a lot of things however, my intention was to be able to run geospatial queries from within R.</p>
<div id="the-geomongo-package" class="section level5">
<h5 class="hasAnchor">
<a href="#the-geomongo-package" class="anchor"></a>The GeoMongo package</h5>
<p>The GeoMongo package allows the user,</p>
<ul>
<li>to insert and query <strong>only</strong> GeoJson data using the <strong>geomongo</strong> R6 class</li>
<li>to read data in either json (through the geojsonR package) or BSON format (I’ll explain later when BSON is necessary for inserting data)</li>
<li>to validate a json instance using a schema using the <strong>json_schema_validator()</strong> function (input parameters are R named lists)</li>
<li>to utilize MongoDB console commands using the <strong>mongodb_console()</strong> function. The <em>mongodb_console()</em> function takes advantage of the base R <em>system()</em> function. For instance, MongoDB console commands are necessary in case of bulk import / export of data as documented <a href="https://docs.mongodb.com/database-tools/mongoimport/">here</a> and <a href="https://docs.mongodb.com/database-tools/mongoexport/">here</a>.</li>
</ul>
<p><br></p>
<p>I was able to reproduce the majority of geospatial MongoDB queries ( System Requirements : MongoDB (&gt;= 3.4) and Python (&gt;= 3.5) ) using a number of blog posts on the web, however I’ll take advantage of the following two in order to explain how one can use the <strong>GeoMongo</strong> package for this purpose:</p>
<ul>
<li>
<a href="http://thecodebarbarian.com/80-20-guide-to-mongodb-geospatial-queries">first example blog post</a> [ The 80/20 Guide to MongoDB Geospatial Queries, by Valeri Karpov]</li>
<li>
<a href="https://docs.mongodb.com/manual/geospatial-queries/">second documentation example</a> [ Geospatial Queries, in MongoDB documentation ]</li>
</ul>
<p><br></p>
</div>
<div id="queries-based-on-first-example-blog-post" class="section level5">
<h5 class="hasAnchor">
<a href="#queries-based-on-first-example-blog-post" class="anchor"></a>queries based on <a href="http://thecodebarbarian.com/80-20-guide-to-mongodb-geospatial-queries">first example blog post</a>
</h5>
<p>When inserting data using the <em>geomongo</em> R6 class the user has the option (via the <em>TYPE_DATA</em> parameter) to either give a <em>character string (or vector)</em>, a <em>list</em>, a <em>file</em> or a <em>folder of files</em> as input. To start with, I’ll use the following character strings ( they appear in the first example blog post , the "_id" ’s were removed),</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlampros/GeoMongo">GeoMongo</a></span><span class="op">)</span>


<span class="co"># important : the property-names of each geojson object should be of type character string</span>

<span class="va">loc1</span> <span class="op">=</span> <span class="st">'{
          "name" : "Squaw Valley",
          "location" : {
              "type" : "Point",
              "coordinates" : [
                  -120.24,
                  39.21
              ]
          }
      }'</span>


<span class="va">loc2</span> <span class="op">=</span> <span class="st">'{
        "name" : "Mammoth Lakes",
        "location" : {
            "type" : "Point",
            "coordinates" : [
                -118.9,
                37.61
            ]
        }
    }'</span>


<span class="va">loc3</span> <span class="op">=</span> <span class="st">'{
        "name" : "Aspen",
        "location" : {
            "type" : "Point",
            "coordinates" : [
                -106.82,
                39.18
            ]
        }
    }'</span>


<span class="va">loc4</span> <span class="op">=</span> <span class="st">'{
        "name" : "Whistler",
        "location" : {
            "type" : "Point",
            "coordinates" : [
                -122.95,
                50.12
            ]
        }
    }'</span>



<span class="co"># create a vector of character strings</span>

<span class="va">char_FILES</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">loc1</span>, <span class="va">loc2</span>, <span class="va">loc3</span>, <span class="va">loc4</span><span class="op">)</span>           </code></pre></div>
<p><br></p>
<p>Before inserting the data one should <strong>make sure that MongoDB is running on the Operating System</strong>. Information on how to <strong>install MongoDB</strong> can be found <a href="https://docs.mongodb.com/manual/installation/">here</a>.</p>
<p><br></p>
<p>The <strong>geomongo</strong> R6 class will be initialized and a database and collection will be created,</p>
<p><br></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span> <span class="op">=</span> <span class="va"><a href="../reference/geomongo.html">geomongo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>host <span class="op">=</span> <span class="st">'localhost'</span>, port <span class="op">=</span> <span class="fl">27017</span><span class="op">)</span>    <span class="co"># assuming MongoDB runs locally</span>

<span class="va">getter_client</span> <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="fu">getClient</span><span class="op">(</span><span class="op">)</span>                          <span class="co"># get MongoClient()</span>

<span class="va">init_db</span> <span class="op">=</span> <span class="va">getter_client</span><span class="op">[[</span><span class="st">"example_db"</span><span class="op">]</span><span class="op">]</span>                   <span class="co"># create a new database</span>

<span class="va">init_col</span> <span class="op">=</span> <span class="va">init_db</span><span class="op">$</span><span class="fu">create_collection</span><span class="op">(</span><span class="st">"example_col"</span><span class="op">)</span>       <span class="co"># create a new collection</span></code></pre></div>
<p><br></p>
<p>After the preliminary steps, one can continue by inserting the <em>char_FILES</em> object to the relevant database / collection using the <strong>geoInsert</strong> method. The <em>TYPE_DATA</em> parameter equals here to <em>dict_many</em> meaning it can take either a <em>list of lists (nested list)</em> or a <em>character vector of strings</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span><span class="op">$</span><span class="fu">geoInsert</span><span class="op">(</span>DATA <span class="op">=</span> <span class="va">char_FILES</span>,              <span class="co"># input data</span>
               
               TYPE_DATA <span class="op">=</span> <span class="st">'dict_many'</span>,        <span class="co"># character vector of strings as input</span>
               
               COLLECTION <span class="op">=</span> <span class="va">init_col</span>,          <span class="co"># specify the relevant collection</span>
               
               GEOMETRY_NAME <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span>     <span class="co"># give the 'geometry name' of each geo-object</span></code></pre></div>
<p><br></p>
<p>One can now run various commands to check the correctness of the inserted data,</p>
<p><br></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init_db</span><span class="op">$</span><span class="fu">collection_names</span><span class="op">(</span><span class="op">)</span>    <span class="co"># prints out the collection names of the relevant database</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="st">"example_col"</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init_col</span><span class="op">$</span><span class="fu">find_one</span><span class="op">(</span><span class="op">)</span>          <span class="co"># prints one of the inserted geometry objects</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">$</span><span class="st">`</span><span class="dt">_id</span><span class="st">`</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>5984a0b742b2563fb5838f6a</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="op">$</span>location</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="op">$</span>location<span class="op">$</span>type</span>
<span id="cb7-6"><a href="#cb7-6"></a>[<span class="dv">1</span>] <span class="st">"Point"</span></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="op">$</span>location<span class="op">$</span>coordinates</span>
<span id="cb7-9"><a href="#cb7-9"></a>[<span class="dv">1</span>] <span class="fl">-120.24</span>   <span class="fl">39.21</span></span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="op">$</span>name</span>
<span id="cb7-13"><a href="#cb7-13"></a>[<span class="dv">1</span>] <span class="st">"Squaw Valley"</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init_col</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span>          <span class="co"># prints the number of the inserted geometry objects</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
<p><br></p>
<p>I’ll continue reproducing some of the geo-queries of the <a href="http://thecodebarbarian.com/80-20-guide-to-mongodb-geospatial-queries">first example blog post</a> from within an R-session.</p>
<p><br></p>
<p>The first query is about the number of locations in the state of Colorado, where Colorado is approximated as the below GeoJson square,</p>
<p><br></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>{</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="st">"type"</span><span class="op">:</span><span class="st"> "Polygon"</span>,</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="st">"coordinates"</span><span class="op">:</span><span class="st"> </span>[[</span>
<span id="cb10-4"><a href="#cb10-4"></a>    [<span class="op">-</span><span class="dv">109</span>, <span class="dv">41</span>],</span>
<span id="cb10-5"><a href="#cb10-5"></a>    [<span class="op">-</span><span class="dv">102</span>, <span class="dv">41</span>],</span>
<span id="cb10-6"><a href="#cb10-6"></a>    [<span class="op">-</span><span class="dv">102</span>, <span class="dv">37</span>],</span>
<span id="cb10-7"><a href="#cb10-7"></a>    [<span class="op">-</span><span class="dv">109</span>, <span class="dv">37</span>],</span>
<span id="cb10-8"><a href="#cb10-8"></a>    [<span class="op">-</span><span class="dv">109</span>, <span class="dv">41</span>]</span>
<span id="cb10-9"><a href="#cb10-9"></a>  ]]</span>
<span id="cb10-10"><a href="#cb10-10"></a>}</span></code></pre></div>
<p><br></p>
<p>and the corresponding MongoDB query would be,</p>
<p><br></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">db.locations.find</span>({</span>
<span id="cb11-2"><a href="#cb11-2"></a>...   location<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb11-3"><a href="#cb11-3"></a>...     <span class="op">$</span>geoIntersects<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb11-4"><a href="#cb11-4"></a>...       <span class="op">$</span>geometry<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb11-5"><a href="#cb11-5"></a>...         type<span class="op">:</span><span class="st"> "Polygon"</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>...         coordinates<span class="op">:</span><span class="st"> </span>[[</span>
<span id="cb11-7"><a href="#cb11-7"></a>...           [<span class="op">-</span><span class="dv">109</span>, <span class="dv">41</span>],</span>
<span id="cb11-8"><a href="#cb11-8"></a>...           [<span class="op">-</span><span class="dv">102</span>, <span class="dv">41</span>],</span>
<span id="cb11-9"><a href="#cb11-9"></a>...           [<span class="op">-</span><span class="dv">102</span>, <span class="dv">37</span>],</span>
<span id="cb11-10"><a href="#cb11-10"></a>...           [<span class="op">-</span><span class="dv">109</span>, <span class="dv">37</span>],</span>
<span id="cb11-11"><a href="#cb11-11"></a>...           [<span class="op">-</span><span class="dv">109</span>, <span class="dv">41</span>]</span>
<span id="cb11-12"><a href="#cb11-12"></a>...         ]]</span>
<span id="cb11-13"><a href="#cb11-13"></a>...       }</span>
<span id="cb11-14"><a href="#cb11-14"></a>...     }</span>
<span id="cb11-15"><a href="#cb11-15"></a>...   }</span>
<span id="cb11-16"><a href="#cb11-16"></a>... })</span></code></pre></div>
<p><br></p>
<p>This query can be <em>translated</em> in R in the following way:</p>
<ul>
<li>
<em>curly braces</em> correspond to <em>R-lists</em>
</li>
<li>
<em>arrays</em> (of size 2) to <em>R-vectors</em>,</li>
</ul>
<p><br></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">query_geoIntersects</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'location'</span> <span class="op">=</span> 
                             
                             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'$geoIntersects'</span> <span class="op">=</span> 
                                    
                                    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'$geometry'</span> <span class="op">=</span> 
                                           
                                           <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                             
                                             type <span class="op">=</span> <span class="st">"Polygon"</span>, 
                                                
                                             coordinates <span class="op">=</span> 
                                               
                                               <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                                 
                                                 <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                                   
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">109</span>, <span class="fl">41</span><span class="op">)</span>, 
                                                   
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">102</span>, <span class="fl">41</span><span class="op">)</span>, 
                                                   
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">102</span>, <span class="fl">37</span><span class="op">)</span>, 
                                                   
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">109</span>, <span class="fl">37</span><span class="op">)</span>, 
                                                   
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">109</span>, <span class="fl">41</span><span class="op">)</span>
                                                   <span class="op">)</span>
                                                 <span class="op">)</span>
                                             <span class="op">)</span>
                                         <span class="op">)</span>
                                  <span class="op">)</span>
                           <span class="op">)</span></code></pre></div>
<p><br></p>
<p>and the <strong>find</strong> METHOD of <strong>geoQuery</strong> function will be used to return locations which are within the boundaries of Colorado,</p>
<p><br></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loc_intersect</span> <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="fu">geoQuery</span><span class="op">(</span>QUERY <span class="op">=</span> <span class="va">query_geoIntersects</span>,      <span class="co"># query from previous chunk</span>
                                  
                              METHOD <span class="op">=</span> <span class="st">"find"</span>,                  <span class="co"># the method to use</span>
                              
                              COLLECTION <span class="op">=</span> <span class="va">init_col</span>,            <span class="co"># the collection to use</span>

                              GEOMETRY_NAME <span class="op">=</span> <span class="st">"location"</span>,       <span class="co"># the geometry name to use</span>
                              
                              TO_LIST <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>                  <span class="co"># returns a data.table</span>

<span class="va">loc_intersect</span></code></pre></div>
<p><br></p>
<p>The output can be returned either as a <em>list</em> or as a <em>data.table</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># data.table format</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>   location.type location.coordinates1 location.coordinates2  name                       id</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="dv">1</span><span class="op">:</span><span class="st">         </span>Point               <span class="fl">-106.82</span>                 <span class="fl">39.18</span> Aspen 5984a0b742b2563fb5838f6c</span></code></pre></div>
<p><br></p>
<p>The next few code chunks will show how to return documents that are <em>within a certain distance of a given point</em> using the <em>geoWithin</em> and <em>centerSphere</em> operators (locations with a square of circumradius 300 miles centered on San Francisco, approximately latitude 37.7, longitude -122.5).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># MongoDB query</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw">db.locations.find</span>({</span>
<span id="cb15-4"><a href="#cb15-4"></a>...   location<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb15-5"><a href="#cb15-5"></a>...     <span class="op">$</span>geoWithin<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb15-6"><a href="#cb15-6"></a>...       <span class="op">$</span>centerSphere<span class="op">:</span><span class="st"> </span>[[<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.7</span>], <span class="dv">300</span> <span class="op">/</span><span class="st"> </span><span class="fl">3963.2</span>]</span>
<span id="cb15-7"><a href="#cb15-7"></a>...     }</span>
<span id="cb15-8"><a href="#cb15-8"></a>...   }</span>
<span id="cb15-9"><a href="#cb15-9"></a>... })</span></code></pre></div>
<p><br></p>
<p>and the corresponding query in R,</p>
<p><br></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geoWithin_sph</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'location'</span> <span class="op">=</span> 
                       
                       <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'$geoWithin'</span> <span class="op">=</span> 
                            
                            <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'$centerSphere'</span> <span class="op">=</span> 
                                   
                                   <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                     
                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.7</span><span class="op">)</span>, <span class="fl">300</span> <span class="op">/</span> <span class="fl">3963.2</span><span class="op">)</span>
                                 <span class="op">)</span>
                          <span class="op">)</span>
                   <span class="op">)</span>


<span class="co"># no need to specify again the "COLLECTION" and "GEOMETRY_NAME" parameters</span>
<span class="co"># as we use the same initialization of the R6 class with the previous query</span>

<span class="va">res_geoWithin_sph</span> <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="fu">geoQuery</span><span class="op">(</span>QUERY <span class="op">=</span> <span class="va">geoWithin_sph</span>,
                                  
                                  METHOD <span class="op">=</span> <span class="st">"find"</span><span class="op">)</span>
<span class="va">res_geoWithin_sph</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># example output</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>   location.type location.coordinates1 location.coordinates2  </span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="dv">1</span><span class="op">:</span><span class="st">         </span>Point               <span class="fl">-118.90</span>                 <span class="fl">37.61</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="dv">2</span><span class="op">:</span><span class="st">         </span>Point               <span class="fl">-120.24</span>                 <span class="fl">39.21</span></span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a>            name                       id</span>
<span id="cb17-8"><a href="#cb17-8"></a>   Mammoth Lakes 5984a0b742b2563fb5838f6b</span>
<span id="cb17-9"><a href="#cb17-9"></a>    Squaw Valley 5984a0b742b2563fb5838f6a</span></code></pre></div>
<p><br></p>
<p>One can read more about the magic number 3963.2 (radius of the Earth) either in the <a href="http://thecodebarbarian.com/80-20-guide-to-mongodb-geospatial-queries">first example blog post</a> or in the <a href="https://docs.mongodb.com/manual/tutorial/calculate-distances-using-spherical-geometry-with-2d-geospatial-indexes/">MongoDB documentation</a>.</p>
<p><br></p>
<p>Here one can also plot the output locations using the <strong>leaflet</strong> package,</p>
<p><br></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_dat</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span>

<span class="va">map_dat</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu">addTiles</span><span class="op">(</span><span class="va">map_dat</span><span class="op">)</span>

<span class="va">map_dat</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu">addMarkers</span><span class="op">(</span><span class="va">map_dat</span>, 
                               
                               lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">res_geoWithin_sph</span><span class="op">$</span><span class="va">location.coordinates1</span><span class="op">)</span>, 
                               
                               lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">res_geoWithin_sph</span><span class="op">$</span><span class="va">location.coordinates2</span><span class="op">)</span><span class="op">)</span>
<span class="va">map_dat</span></code></pre></div>
<p><br></p>
<p><img src="leaflet1.png"></p>
<p><br></p>
<p>The next query utilizes the <strong>aggregate</strong> method to return the locations <em>sorted by distance from a given point</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># MongoDB query</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">db.locations.aggregate</span>([{</span>
<span id="cb19-4"><a href="#cb19-4"></a>...   <span class="op">$</span>geoNear<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb19-5"><a href="#cb19-5"></a>...     near<span class="op">:</span><span class="st"> </span>{</span>
<span id="cb19-6"><a href="#cb19-6"></a>...       type<span class="op">:</span><span class="st"> 'Point'</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>...       coordinates<span class="op">:</span><span class="st"> </span>[<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.1</span>]</span>
<span id="cb19-8"><a href="#cb19-8"></a>...     },</span>
<span id="cb19-9"><a href="#cb19-9"></a>...     spherical<span class="op">:</span><span class="st"> </span>true,</span>
<span id="cb19-10"><a href="#cb19-10"></a>...     maxDistance<span class="op">:</span><span class="st"> </span><span class="dv">900</span> <span class="op">*</span><span class="st"> </span><span class="fl">1609.34</span>,</span>
<span id="cb19-11"><a href="#cb19-11"></a>...     distanceMultiplier<span class="op">:</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="fl">1609.34</span>,</span>
<span id="cb19-12"><a href="#cb19-12"></a>...     distanceField<span class="op">:</span><span class="st"> 'distanceFromSF'</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>...   }</span>
<span id="cb19-14"><a href="#cb19-14"></a>... }])</span></code></pre></div>
<p><br></p>
<p>and the corresponding query in R,</p>
<p><br></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">query_geonear</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'$geoNear'</span> <span class="op">=</span> 
                       
                       <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>near <span class="op">=</span> 
                              
                              <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                
                                type <span class="op">=</span> <span class="st">"Point"</span>, 
                                  
                                coordinates <span class="op">=</span> 
                                  
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.1</span><span class="op">)</span>
                                
                                <span class="op">)</span>, 
                            
                            distanceField <span class="op">=</span> <span class="st">"distanceFromSF"</span>, 
                            
                            maxDistance <span class="op">=</span> <span class="fl">900</span> <span class="op">*</span> <span class="fl">1609.34</span>,
                            
                            distanceMultiplier <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1609.34</span>, 
                            
                            spherical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
                     <span class="op">)</span>


<span class="va">func_quer_geonear</span> <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="fu">geoQuery</span><span class="op">(</span>QUERY <span class="op">=</span> <span class="va">query_geonear</span>, 
                                  
                                  METHOD <span class="op">=</span> <span class="st">"aggregate"</span><span class="op">)</span>
<span class="va">func_quer_geonear</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># example output</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a>   distanceFromSF location.type location.coordinates1 location.coordinates2   </span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="dv">1</span><span class="op">:</span><span class="st">       </span><span class="fl">190.8044</span>         Point               <span class="fl">-120.24</span>                 <span class="fl">39.21</span>  </span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="dv">2</span><span class="op">:</span><span class="st">       </span><span class="fl">201.0443</span>         Point               <span class="fl">-118.90</span>                 <span class="fl">37.61</span> </span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="dv">3</span><span class="op">:</span><span class="st">       </span><span class="fl">863.9478</span>         Point               <span class="fl">-106.82</span>                 <span class="fl">39.18</span>        </span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a>           name                           id</span>
<span id="cb21-9"><a href="#cb21-9"></a>   Squaw Valley     5984a0b742b2563fb5838f6a</span>
<span id="cb21-10"><a href="#cb21-10"></a>  Mammoth Lakes     5984a0b742b2563fb5838f6b</span>
<span id="cb21-11"><a href="#cb21-11"></a>          Aspen     5984a0b742b2563fb5838f6c</span></code></pre></div>
<p><br><br></p>
</div>
<div id="queries-based-on-the-second-mongodb-documentation-example" class="section level5">
<h5 class="hasAnchor">
<a href="#queries-based-on-the-second-mongodb-documentation-example" class="anchor"></a>queries based on the <a href="https://docs.mongodb.com/manual/geospatial-queries/">second (MongoDB) documentation example</a>
</h5>
<p><br></p>
<p>I picked this documentation example in order to show how someone can use the <strong>command</strong> METHOD besides the <strong>find</strong> and <strong>aggregate</strong> methods.</p>
<p><br></p>
<p>First I’ll build a new collection (<em>places</em>) and then I’ll insert the example data,</p>
<p><br></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">places_col</span> <span class="op">=</span> <span class="va">init_db</span><span class="op">$</span><span class="fu">create_collection</span><span class="op">(</span><span class="st">"places"</span><span class="op">)</span>       <span class="co"># create a new collection</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># important : the property-names of each geojson object should be of type character string</span>

<span class="va">place1</span> <span class="op">=</span> <span class="st">'{
          "name": "Central Park",
          "location": { "type": "Point", "coordinates": [ -73.97, 40.77 ] },
          "category": "Parks"
          }'</span>


<span class="va">place2</span> <span class="op">=</span> <span class="st">'{
         "name": "Sara D. Roosevelt Park",
         "location": { "type": "Point", "coordinates": [ -73.9928, 40.7193 ] },
         "category": "Parks"
        }'</span>


<span class="va">place3</span> <span class="op">=</span> <span class="st">'{
       "name": "Polo Grounds",
       "location": { "type": "Point", "coordinates": [ -73.9375, 40.8303 ] },
       "category": "Stadiums"
        }'</span>


<span class="co"># create a vector of character strings</span>

<span class="va">doc_FILES</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">place1</span>, <span class="va">place2</span>, <span class="va">place3</span><span class="op">)</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span><span class="op">$</span><span class="fu">geoInsert</span><span class="op">(</span>DATA <span class="op">=</span> <span class="va">doc_FILES</span>,               <span class="co"># insert data</span>
               
               TYPE_DATA <span class="op">=</span> <span class="st">'dict_many'</span>,        <span class="co"># character vector of strings as input</span>
               
               COLLECTION <span class="op">=</span> <span class="va">places_col</span>,        <span class="co"># specify the relevant collection</span>
               
               GEOMETRY_NAME <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span>     <span class="co"># give the 'geometry name' of each geo-object</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># outputs the collection names</span>

<span class="va">init_db</span><span class="op">$</span><span class="fu">collection_names</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># example output</span></span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>[<span class="dv">1</span>] <span class="st">"places"</span>      <span class="st">"example_col"</span></span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">places_col</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span>          <span class="co"># number of geojson objects in collection</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span></code></pre></div>
<p><br></p>
<p>After the data is inserted one can now query the data using the <strong>command</strong> METHOD.</p>
<p><br></p>
<p>Worth mentioning for this particular method are the differences between MongoDB and PyMongo. The following code chunk shows the MongoDB <em>runCommand</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">db.runCommand</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>   {</span>
<span id="cb29-3"><a href="#cb29-3"></a>     geoNear<span class="op">:</span><span class="st"> "places"</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>     near<span class="op">:</span><span class="st"> </span>{ type<span class="op">:</span><span class="st"> "Point"</span>, coordinates<span class="op">:</span><span class="st"> </span>[ <span class="fl">-73.9667</span>, <span class="fl">40.78</span> ] },</span>
<span id="cb29-5"><a href="#cb29-5"></a>     spherical<span class="op">:</span><span class="st"> </span>true,</span>
<span id="cb29-6"><a href="#cb29-6"></a>     query<span class="op">:</span><span class="st"> </span>{ category<span class="op">:</span><span class="st"> "Parks"</span> }</span>
<span id="cb29-7"><a href="#cb29-7"></a>   }</span>
<span id="cb29-8"><a href="#cb29-8"></a>)</span></code></pre></div>
<p><br></p>
<p>which corresponds to the following query in <em>GeoMongo</em> (similar to PyMongo),</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Args_Kwargs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"geoNear"</span>, <span class="st">"places"</span>,

                   near <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"type"</span> <span class="op">=</span> <span class="st">"Point"</span>, <span class="st">"coordinates"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">73.9667</span>, <span class="fl">40.78</span><span class="op">)</span><span class="op">)</span>,

                   spherical <span class="op">=</span> <span class="cn">TRUE</span>,

                   query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"category"</span> <span class="op">=</span> <span class="st">"Parks"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><br></p>
<p>Information about the various parameters of the <em>command</em> method can be found in the <a href="https://pymongo.readthedocs.io/en/stable/api/pymongo/database.html">PyMongo documentation</a>.</p>
<p><br></p>
<p>Then the GeoMongo <strong>command</strong> method takes the parameters in the same way as the <em>find</em> or <em>aggregate</em> methods,</p>
<p><br></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span><span class="op">$</span><span class="fu">geoQuery</span><span class="op">(</span>QUERY <span class="op">=</span> <span class="va">Args_Kwargs</span>, 
              
              METHOD <span class="op">=</span> <span class="st">"command"</span>, 
              
              COLLECTION <span class="op">=</span> <span class="va">places_col</span>, 
              
              DATABASE <span class="op">=</span> <span class="va">init_db</span>,             <span class="co"># additionally I have to specify the database</span>

              TO_LIST <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><br></p>
<p>which returns only the ‘Parks’ (of the <em>category</em> property name) from the input documents,</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>   obj.category obj.location.type obj.location.coordinates1 obj.location.coordinates2  </span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="dv">1</span><span class="op">:</span><span class="st">        </span>Parks             Point                  <span class="fl">-73.9700</span>                   <span class="fl">40.7700</span>        </span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="dv">2</span><span class="op">:</span><span class="st">        </span>Parks             Point                  <span class="fl">-73.9928</span>                   <span class="fl">40.7193</span> </span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a>                 obj.name      dis                       id</span>
<span id="cb32-6"><a href="#cb32-6"></a>             Central Park <span class="fl">1147.422</span> 5985b4d242b2563fb5838f6e</span>
<span id="cb32-7"><a href="#cb32-7"></a>   Sara D. Roosevelt Park <span class="fl">7106.506</span> 5985b4d242b2563fb5838f6f</span></code></pre></div>
<p><br></p>
<p>The following two blog posts include also a variety of geospatial queries ( <a href="http://tugdualgrall.blogspot.com/2014/08/introduction-to-mongodb-geospatial.html">here</a> and <a href="https://docs.mongodb.com/manual/tutorial/geospatial-tutorial/">here</a> ).</p>
<p><br></p>
<p>More details about the <em>geomongo</em> R6 class and each method (<em>read_mongo_bson()</em>, <em>geoInsert()</em>, <em>geoQuery()</em>) can be found in the <em>Details</em> and <em>Methods</em> of the package documentation.</p>
<p><br></p>
</div>
<div id="when-to-input-data-in-bson-rather-than-in-json-format-applies-to-the-geomongo-r6-class" class="section level5">
<h5 class="hasAnchor">
<a href="#when-to-input-data-in-bson-rather-than-in-json-format-applies-to-the-geomongo-r6-class" class="anchor"></a>When to input data in bson rather than in json format (applies to the geomongo R6 class)</h5>
<p><br></p>
<p>When inserting data to MongoDB there are cases where the <em>id</em> appears in the following format,</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data taken from :  https://docs.mongodb.com/manual/tutorial/geospatial-tutorial/</span>

<span class="va">example_dat</span> <span class="op">=</span> <span class="st">'{"_id":
                      {"$oid":"55cba2476c522cafdb053add"},
                "location":
                      {"coordinates":[-73.856077,40.848447],"type":"Point"},
                "name":"Morris Park Bake Shop"}'</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bson_col</span> <span class="op">=</span> <span class="va">init_db</span><span class="op">$</span><span class="fu">create_collection</span><span class="op">(</span><span class="st">"example_bson"</span><span class="op">)</span>       <span class="co"># create a new collection</span></code></pre></div>
<p><br></p>
<p>Inserting the <em>example_dat</em> in the <em>bson_col</em> will raise an error,</p>
<p><br></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span><span class="op">$</span><span class="fu">geoInsert</span><span class="op">(</span>DATA <span class="op">=</span> <span class="va">example_dat</span>,             <span class="co"># insert data</span>
             
              TYPE_DATA <span class="op">=</span> <span class="st">'dict_one'</span>,          <span class="co"># single list as input</span>
             
              COLLECTION <span class="op">=</span> <span class="va">bson_col</span>,           <span class="co"># specify the relevant collection</span>
             
              GEOMETRY_NAME <span class="op">=</span> <span class="st">"location"</span>,      <span class="co"># give the 'geometry name' of each geo-object</span>
              
              read_method <span class="op">=</span> <span class="st">"geojsonR"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># example output</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>Error <span class="cf">in</span> <span class="kw">py_call_impl</span>(callable, dots<span class="op">$</span>args, dots<span class="op">$</span>keywords) <span class="op">:</span><span class="st"> </span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="st">  </span>InvalidDocument<span class="op">:</span><span class="st"> </span>key <span class="st">'$oid'</span> must not start with <span class="st">'$'</span></span></code></pre></div>
<p><br></p>
<p>This error is explained also in a similar <a href="https://stackoverflow.com/questions/42089045/bson-errors-invaliddocument-key-oid-must-not-start-with-trying-to-insert">StackOverflow question</a></p>
<p><br></p>
<p>In such a case, one has to change the <em>read_method</em> to <strong>mongo_bson</strong> to correctly insert the data,</p>
<p><br></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">init</span><span class="op">$</span><span class="fu">geoInsert</span><span class="op">(</span>DATA <span class="op">=</span> <span class="va">example_dat</span>,             <span class="co"># insert data</span>
             
              TYPE_DATA <span class="op">=</span> <span class="st">'dict_one'</span>,          <span class="co"># single character string as input</span>
             
              COLLECTION <span class="op">=</span> <span class="va">bson_col</span>,           <span class="co"># specify the relevant collection</span>
             
              GEOMETRY_NAME <span class="op">=</span> <span class="st">"location"</span>,      <span class="co"># give the 'geometry name' of each geo-object</span>
              
              read_method <span class="op">=</span> <span class="st">"mongo_bson"</span><span class="op">)</span></code></pre></div>
<p><br></p>
<p>Finally, we can check the correctness of the inserted data,</p>
<p><br></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bson_col</span><span class="op">$</span><span class="fu">count</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># example output</span></span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bson_col</span><span class="op">$</span><span class="fu">find_one</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># example output</span></span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="op">$</span><span class="st">`</span><span class="dt">_id</span><span class="st">`</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>55cba2476c522cafdb053add</span>
<span id="cb41-5"><a href="#cb41-5"></a></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="op">$</span>location</span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="op">$</span>location<span class="op">$</span>type</span>
<span id="cb41-8"><a href="#cb41-8"></a>[<span class="dv">1</span>] <span class="st">"Point"</span></span>
<span id="cb41-9"><a href="#cb41-9"></a></span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="op">$</span>location<span class="op">$</span>coordinates</span>
<span id="cb41-11"><a href="#cb41-11"></a>[<span class="dv">1</span>] <span class="fl">-73.85608</span>  <span class="fl">40.84845</span></span>
<span id="cb41-12"><a href="#cb41-12"></a></span>
<span id="cb41-13"><a href="#cb41-13"></a></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="op">$</span>name</span>
<span id="cb41-15"><a href="#cb41-15"></a>[<span class="dv">1</span>] <span class="st">"Morris Park Bake Shop"</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lampros Mouselimis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
